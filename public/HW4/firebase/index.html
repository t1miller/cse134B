<!DOCTYPE html>
<html>
<head>
	<title>Selection</title>
	<meta charset="UTF-8">
	<link rel="stylesheet" type="text/css" href="styles.css">
	<script src="https://www.gstatic.com/firebasejs/3.6.10/firebase.js"></script>
	<script src="https://www.gstatic.com/firebasejs/3.6.10/firebase-app.js"></script>
	<script src="https://www.gstatic.com/firebasejs/3.6.10/firebase-auth.js"></script>
	<script src="https://www.gstatic.com/firebasejs/3.6.10/firebase-database.js"></script>
	<script>
	  // Initialize Firebase
	  var config = {
	    apiKey: "AIzaSyDuF_qzwkeOCG9F4_I2eJTVcLxFkHnbdPQ",
	    authDomain: "overdex-f33ef.firebaseapp.com",
	    databaseURL: "https://overdex-f33ef.firebaseio.com/",
	    storageBucket: "gs://overdex-f33ef.appspot.com",
	    messagingSenderId: "<SENDER_ID>"
	  };
	  firebase.initializeApp(config);
	  firebase.auth().onAuthStateChanged(function(user) {
		  if (!user){
		  	window.location.replace("login.html");
		    // No user is signed in.
		  }
	  });

	</script>
</head>
<body>
	<button type="button" id="logout" onclick="logout()">Logout</button>
	<form action="#" id="addHeroForm">
	  	<select name="hero">
		    <option value="Ana">Ana</option>
		    <option value="Bastion">Bastion</option>
		    <option value="DVa">DVa</option>
		    <option value="Genji">Genji</option>
		    <option value="Hanzo">Hanzo</option>
		    <option value="Junkrat">Junkrat</option>
		    <option value="Lucio">Lucio</option>
		    <option value="McCree">McCree</option>
		    <option value="Mei">Mei</option>
		    <option value="Mercy">Mercy</option>
		    <option value="Pharah">Pharah</option>
		    <option value="Reaper">Reaper</option>
		    <option value="Reinhardt">Reinhardt</option>
		    <option value="Roadhog">Roadhog</option>
		    <option value="Soldier">Soldier</option>
		    <option value="Symmetra">Symmetra</option>
		    <option value="Torbjorn">Torbjorn</option>
		    <option value="Tracer">Tracer</option>
		    <option value="Widowmaker">Widowmaker</option>
		    <option value="Winston">Winston</option>
		    <option value="Zarya">Zarya</option>
		    <option value="Zenyatta">Zenyatta</option>
	  	</select>
	  	<input type="button" value="+" name="addHeroButton" onclick="addHero()">
	</form>
	
	<script>
	function updateStats() {
		var updateFormExists = document.getElementById("update-stats-form");
		if (updateFormExists != null) {
			return;
		}

		var updateStatsForm = document.createElement("DIV");
		updateStatsForm.id = "update-stats-form";

		updateStatsForm.innerHTML = "<form action=\"#\">"+
                    					"Games Won:"+
                    					"<input type=\"text\" name=\"gameswon\"><br>"+
                    					"Games Lost:"+
					                    "<input type=\"text\" name=\"gameslost\"><br>"+
					                    "Time Played:"+
					                    "<input type=\"text\" name=\"timeplayed\"><br>"+
					                    "Eliminations:"+
					                    "<input type=\"text\" name=\"eliminations\"><br>"+
					                    "Deaths:"+
					                    "<input type=\"text\" name=\"deaths\"><br>"+
					                    "<input type=\"submit\" value=\"submit-update\">"+
					                "</form>";

		document.getElementsByClassName("hero-card")[0].appendChild(updateStatsForm);
	}
	
	function logout(){
		firebase.auth().signOut().then(function() {
			window.location.replace("login.html");
		}, function(error) {
		 	console.log("Error logging out");
		});
	}

	function heroPortraitLookUp(heroName){
		baseDir = "HeroPortraits/";
		return baseDir+heroName+"Portrait.png";
	}

	//takes form data and pumps out a template
	function formToTemplate(formData){
		//hero card div
		var heroCardDiv = document.createElement("DIV");
		heroCardDiv.className = "hero-card";

		//hero portrait div
		var heroPortraitDiv = document.createElement("DIV");
		heroPortraitDiv.className = "hero-portrait";
		heroPortraitDiv.innerHTML = "<img class=\"hero-image\" src=\""+heroPortraitLookUp(formData["hero"])+"\" alt=\"Hanzo Portrait\">" //TODO

		//hero background info div
		var backgroundInfoDiv = document.createElement("DIV");
		backgroundInfoDiv.className = "background-info";
		backgroundInfoDiv.innerHTML = "<h3 class=\"title\">"+formData["hero"]+"</h3>"+
                						"<ul class=\"list-fields\">"+
        									"<li>Origin:</li>"+
						                    "<li>Role:</li>"+
						                    "<li>Health:</li>"+
						                    "<li>Ultimate:</li>"+
						                    "<li>Member of Overwatch:</li>"+
						                "</ul>";       					

		//user stats div
		var userStatsDiv = document.createElement("DIV");
		userStatsDiv.className = "user-stats";
		userStatsDiv.innerHTML = "<h3 class=\"title\">Stats</h3>"+
            					 "<ul class=\"list-fields\">"+
                    				"<li>Wins:</li>" +
                    				"<li>Losses:</li>" +
				                    "<li>Win-rate:</li>" +
				                    "<li>Time Played:</li>" +
				                    "<li>Eliminations/Death:</li>" +
			               	     "</ul>" +
				                 "<form class=\"update-stats\" action=\"#\">"+
				                    "<input type=\"submit\" value=\"Edit\" onClick=\"updateStats();\">" +
				                 "</form>";
		
		//append all of hero card div's children
		heroCardDiv.appendChild(heroPortraitDiv);
		heroCardDiv.appendChild(backgroundInfoDiv);
		heroCardDiv.appendChild(userStatsDiv);
		
		document.getElementsByTagName("BODY")[0].appendChild(heroCardDiv);
	}

	//extract form data 
	function addHero() {
		var dict = {};
		dict["hero"] = document.getElementById("addHeroForm").elements["hero"].value;

		//error checking
		if(dict["hero"] == "" ){
			alert("Please fill out all form fields");
			return;
		}

		var user = firebase.auth().currentUser;
		addHeroDB(user.uid,dict["hero"]);

		formToTemplate(dict)
	}
	
	function addHeroDB(user, hero) {
	  // A post entry.
	  var postData = {
	    "wins": 0,
	    "losses": 0,
	    "timePlayed": 0,
	    "eliminations": 0,
	    "deaths": 0
	  };

	  // Write the new post's data simultaneously in the posts list and the user's post list.
	  var updates = {};
	  updates['/users/' + user + "/favorites/" + hero] = postData;
	  return firebase.database().ref().update(updates);
	}
	

	</script>

</body>
</html>